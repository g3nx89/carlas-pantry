# /sdd:01-specify Configuration
# ================================
# Centralized configuration for the specification workflow.
# All limits, thresholds, and feature flags are defined here.
#
# Referenced by:
# - $CLAUDE_PLUGIN_ROOT/skills/specify/SKILL.md
# - $CLAUDE_PLUGIN_ROOT/commands/specify.md (thin wrapper)
# - $CLAUDE_PLUGIN_ROOT/agents/business-analyst.md
# - $CLAUDE_PLUGIN_ROOT/skills/specify/references/clarification-protocol.md

---

# Version tracking
version: "2.3.0"
last_updated: "2026-01-26"

# =============================================================================
# WORKFLOW LIMITS
# =============================================================================
# These control iteration counts and marker limits throughout the workflow.
# NOTE: No artificial limits on user clarifications, user stories, or NFRs.
# The workflow should gather ALL necessary information for complete specifications.

limits:
  # REMOVED: clarification_markers_max - No limit on clarification markers
  # REMOVED: clarification_iterations_max - No limit on clarification iterations
  # The workflow continues until ALL clarifications are resolved

  # Maximum PAL rejection retries (Phase 5)
  # After this many rejections, escalates to user decision
  pal_rejection_retries_max: 2

  # DEPRECATED: questions_per_batch — replaced by file-based clarification (v2.2.1)
  # Kept for backward compatibility; not used in file-based mode
  questions_per_batch: 4  # deprecated

  # Lock file staleness threshold (hours)
  # Locks older than this are considered stale and auto-removed
  lock_staleness_hours: 2

  # EXPLICIT: No limits on content generation
  # These are explicitly set to unlimited (null) for clarity
  max_user_stories: null           # No limit - generate as many as needed
  max_acceptance_criteria: null    # No limit - be thorough
  max_nfrs: null                   # No limit - capture all non-functional requirements
  max_clarification_questions: null # No limit - ask everything needed
  max_clarification_batches: null  # No limit - iterate until complete

# =============================================================================
# QUALITY THRESHOLDS
# =============================================================================
# Thresholds for quality gates. Values are percentages or points.

thresholds:
  # Checklist validation (Phase 4) - percentage coverage
  checklist:
    green: 85    # >= this: HIGH coverage, proceed to PAL
    yellow: 60   # >= this: MEDIUM coverage, proceed to clarifications
    # < yellow: LOW coverage, iterate with BA

  # PAL Consensus (Phase 5) - points out of 20
  pal:
    green: 16    # >= this: APPROVED
    yellow: 12   # >= this: CONDITIONAL (proceed with warnings)
    # < yellow: REJECTED (iterate or escalate)

  # Self-Critique (BA Agent) - points out of 20
  self_critique:
    pass: 16     # >= this: Ready for submission
    conditional: 12  # >= this: Minor revision needed
    # < conditional: Significant rework required

  # Incremental Gates (P2 enhancement)
  incremental_gates:
    problem_quality_min_score: 3    # Minimum score (1-4) for problem statement
    true_need_confidence_min: "medium"  # Minimum confidence: low, medium, high

# =============================================================================
# FEATURE FLAGS
# =============================================================================
# Enable/disable experimental or optional features.

feature_flags:
  # P2: Enable incremental validation gates after Problem Framing and True Need Discovery
  enable_incremental_gates: true

  # P3: Enable complexity-based workflow triage (SIMPLE/MEDIUM/COMPLEX)
  enable_complexity_triage: false  # Planned for future release

  # P5: Enable parallel execution of Phase 5 and Phase 5.5
  enable_parallel_phase_5: false  # Requires orchestrator changes

  # Enable CLI multi-stance validation in Stage 5
  enable_cli_validation: true

  # Enable self-critique in BA agent (mandatory for quality)
  enable_self_critique: true

  # Enable Figma integration prompts (--figma / --no-figma override)
  enable_figma_integration: true

  # Enable Research Discovery Phase (Phase 1.7 and 1.8)
  enable_research_discovery: true

  # Enable Test Strategy Generation Phase (Phase 5.7)
  enable_test_strategy: true

# =============================================================================
# RESEARCH DISCOVERY CONFIGURATION
# =============================================================================
# Configuration for the Research Discovery Phase (1.7 and 1.8).
# Generates deep research questions for user investigation before spec drafting.

research_discovery:
  # Master switch
  enabled: true
  version: "1.0.0"

  # ─────────────────────────────────────────────────────────────
  # MODE SELECTION
  # ─────────────────────────────────────────────────────────────
  # Simple mode: Single BA agent generates questions (faster, cheaper)
  # MPA mode: 3 specialized agents (Business, Technical, UX) with synthesis

  default_mode: "simple"  # simple | mpa

  modes:
    simple:
      agent: "$CLAUDE_PLUGIN_ROOT/agents/business-analyst.md"
      model: "sonnet"
      sequential_thinking: true
      min_questions: 4
      max_questions: 8

    mpa:
      parallel: true
      agents:
        - name: "strategic"
          agent: "$CLAUDE_PLUGIN_ROOT/agents/research-discovery-business.md"
          model: "sonnet"
          output: "questions-strategic.md"
        - name: "technical"
          agent: "$CLAUDE_PLUGIN_ROOT/agents/research-discovery-technical.md"
          model: "sonnet"
          output: "questions-technical.md"
        - name: "ux"
          agent: "$CLAUDE_PLUGIN_ROOT/agents/research-discovery-ux.md"
          model: "sonnet"
          output: "questions-ux.md"
      synthesis:
        agent: "$CLAUDE_PLUGIN_ROOT/agents/research-question-synthesis.md"
        model: "sonnet"
        output: "research-questions.md"

  # ─────────────────────────────────────────────────────────────
  # QUESTION GENERATION
  # ─────────────────────────────────────────────────────────────

  question_generation:
    # Minimum depth score (1-5) for inclusion
    min_depth_score: 3.0

    # Priority levels
    priorities:
      - name: "CRITICAL"
        description: "Could invalidate entire approach"
        research_time: "2-4 hours"
      - name: "HIGH"
        description: "Significantly shapes requirements"
        research_time: "1-2 hours"
      - name: "MEDIUM"
        description: "Refines understanding"
        research_time: "30-60 min"

    # Question categories
    categories:
      - "Strategic"      # Market, competitive, business model
      - "Technical"      # Architecture, scalability, compliance
      - "UX"             # User behavior, community, adoption
      - "Competitive"    # Competitor analysis, gap analysis

  # ─────────────────────────────────────────────────────────────
  # USER DECISION POINT
  # ─────────────────────────────────────────────────────────────

  user_decision:
    prompt:
      question: "Research questions have been generated. How would you like to proceed?"
      header: "Research"
      options:
        - label: "Conduct research (Recommended)"
          description: "I'll research these questions and provide reports"
          action: "conduct_research"
        - label: "Skip with context"
          description: "I have domain knowledge to share instead"
          action: "skip_with_context"
        - label: "Skip entirely"
          description: "Proceed without external research"
          action: "skip_entirely"

  # ─────────────────────────────────────────────────────────────
  # RESEARCH REPORT ANALYSIS (Phase 1.8)
  # ─────────────────────────────────────────────────────────────

  report_analysis:
    # Directory where user saves research reports
    reports_directory: "research/"

    # Expected report patterns
    report_patterns:
      - "research-*.md"
      - "*.research.md"

    # Synthesis agent
    synthesis:
      agent: "$CLAUDE_PLUGIN_ROOT/agents/research-question-synthesis.md"
      model: "sonnet"
      output: "research-synthesis.md"

    # Detection behavior
    detection:
      min_reports: 1  # Minimum reports to proceed with analysis
      warn_if_missing_categories: true  # Warn if major categories have no research

    # Annotation format for spec
    annotation_format: "@ResearchRef(finding=\"{finding_id}\", source=\"{source_file}\")"

  # ─────────────────────────────────────────────────────────────
  # OUTPUT CONFIGURATION
  # ─────────────────────────────────────────────────────────────

  output:
    questions_file: "research-questions.md"
    synthesis_file: "research-synthesis.md"
    reports_directory: "research/"

  # ─────────────────────────────────────────────────────────────
  # TEMPLATES
  # ─────────────────────────────────────────────────────────────

  templates:
    questions: "specs/templates/research-questions-template.md"
    synthesis: "specs/templates/research-synthesis-template.md"
    report: "specs/templates/research-report-template.md"

# =============================================================================
# CLARIFICATION CONFIGURATION (v2.0)
# =============================================================================
# File-based clarification replaces interactive AskUserQuestion batching.
# All questions written to a single file for offline editing.

clarification:
  # Clarification mode: file_based (write questions to file, user edits offline)
  mode: "file_based"
  version: "2.0.0"

  # Output file for clarification questions
  questions_file: "clarification-questions.md"

  # ─────────────────────────────────────────────────────────────
  # AUTO-RESOLVE GATE
  # ─────────────────────────────────────────────────────────────
  # Pre-filters questions answerable from existing input documents
  # before writing to the question file.

  auto_resolve:
    enabled: true
    confidence_required: "high"  # Only auto-resolve with high confidence
    sources:
      - "input_documents"   # Original user input, research reports
      - "prior_decisions"   # Previous user_decisions from state file
      - "spec_content"      # Already-drafted spec sections
    registry_file: "clarification-report.md"
    notify_user: true  # Always inform user of auto-resolutions

# =============================================================================
# COMPLEXITY TRIAGE (P3 - Future)
# =============================================================================
# Criteria for automatic workflow complexity selection.
# Currently inactive (enable_complexity_triage: false)

complexity_triage:
  criteria:
    user_stories:
      simple: [1, 3]      # 1-3 stories
      medium: [4, 8]      # 4-8 stories
      complex: [9, null]  # 9+ stories (null = no upper limit)
    stakeholders:
      simple: [1, 1]
      medium: [2, 3]
      complex: [4, null]
    integrations:
      simple: [0, 0]
      medium: [1, 2]
      complex: [3, null]

  workflow_phases:
    simple:
      skip: ["jtbd", "competitive", "stakeholder_detailed"]
      templates_count: 6
    medium:
      skip: ["competitive"]
      templates_count: 12
    complex:
      skip: []
      templates_count: 15  # After P1 consolidation (was 25)

# =============================================================================
# AGENT RESPONSE SCHEMA (P6)
# =============================================================================
# Standard response format for all agents in the workflow.
# Agents MUST return responses matching this schema.

agent_response_schema:
  version: "1.0"
  required_fields:
    - status        # success | partial | error
    - outputs       # List of files created/modified
    - next_step     # Description of recommended next action

  optional_fields:
    - metrics       # Numeric metrics (scores, counts)
    - warnings      # List of warning messages
    - errors        # List of error messages (if status != success)
    - user_decisions_needed  # Questions requiring user input

  status_values:
    success: "All tasks completed successfully"
    partial: "Some tasks completed, others need attention"
    error: "Critical failure, cannot proceed"

  output_actions:
    created: "New file created"
    updated: "Existing file modified"
    deleted: "File removed"

# =============================================================================
# CHECKPOINT PROTOCOL (P4)
# =============================================================================
# Unified checkpoint mechanism using YAML state file only.
# HTML comment checkpoints in agent output are DEPRECATED.

checkpoint_protocol:
  # Single source of truth for workflow state
  state_file_pattern: ".specify-state.local.md"

  # Deprecated mechanisms (for migration reference)
  deprecated:
    - html_comments: "<!-- CHECKPOINT: ... -->"
    - lock_file_phase: "phase: X in lock file"

  # Required fields in state file phases section
  phase_state_fields:
    - status        # pending | in_progress | completed | error
    - timestamp     # ISO 8601 format
    - outputs       # List of generated files
    - metrics       # Phase-specific metrics

  # Example phase state entry
  example: |
    phases:
      spec_draft:
        status: completed
        timestamp: "2025-01-21T10:30:00Z"
        outputs:
          - file: spec.md
            action: created
            lines: 245
        metrics:
          self_critique_score: 17
          user_stories_count: 8
          requirements_count: 15

# =============================================================================
# INCREMENTAL GATES CONFIGURATION (P2)
# =============================================================================
# Configuration for early validation gates.

incremental_gates:
  # Gate 1: After Problem Framing (BA Phase 0)
  gate_1_problem_quality:
    enabled: true
    trigger_after: "problem_framing"
    evaluation_criteria:
      - "Problem statement is specific (not generic)"
      - "Target persona is clearly identified"
      - "Impact/pain point is measurable or observable"
      - "Root cause is articulated (not just symptoms)"

    # Scoring: Each criterion is 1 point (max 4)
    thresholds:
      green: 4      # All criteria met - proceed
      yellow: 3     # Minor gaps - proceed with note
      red: 2        # Significant gaps - require refinement

    # Question template for user validation
    user_prompt:
      question: "Review the problem statement below. Does it accurately capture the core issue?"
      header: "Problem"
      options:
        - label: "Yes, proceed (Recommended)"
          description: "Problem is specific, actionable, and well-articulated"
        - label: "Needs refinement"
          description: "Problem is vague or missing key elements - iterate"
        - label: "Need more context"
          description: "I need to provide additional information"

  # Gate 2: After Requirements Discovery (BA Phase 1)
  gate_2_true_need:
    enabled: true
    trigger_after: "requirements_discovery"
    evaluation_criteria:
      - "True need differs from stated request (root cause found)"
      - "Stakeholder motivations are documented"
      - "Success criteria are defined"
      - "Business value is articulated"

    thresholds:
      green: 4
      yellow: 3
      red: 2

    user_prompt:
      question: "The analysis identified the true business need. Does this align with your understanding?"
      header: "True Need"
      options:
        - label: "Yes, this captures it (Recommended)"
          description: "The true need goes beyond the surface request"
        - label: "Partially correct"
          description: "Some aspects are right, but missing elements"
        - label: "No, needs rework"
          description: "The analysis missed the core need"

# =============================================================================
# DEPRECATION NOTICES
# =============================================================================
# Features or patterns that are deprecated and will be removed.

deprecations:
  - feature: "HTML checkpoint comments in agent output"
    deprecated_in: "2.0.0"
    removed_in: "3.0.0"
    migration: "Use YAML state file only (checkpoint_protocol section)"

  - feature: "Hardcoded limits in agent files"
    deprecated_in: "2.0.0"
    removed_in: "3.0.0"
    migration: "Reference specs/config/specify-config.yaml"

  - feature: "Unstructured agent markdown responses"
    deprecated_in: "2.0.0"
    removed_in: "3.0.0"
    migration: "Use agent_response_schema format"

# =============================================================================
# SADD PATTERN CONFIGURATION (v1.1)
# =============================================================================
# Subagent-Driven Development patterns for multi-agent specification workflow.

sadd_patterns:
  enabled: true
  version: "1.1.0"

  # ─────────────────────────────────────────────────────────────
  # MODEL ASSIGNMENT (Critical for cost control)
  # ─────────────────────────────────────────────────────────────
  model_assignments:
    sonnet:
      - "gate-judge"
      - "qa-strategist"  # V-Model test strategy generation

  # ─────────────────────────────────────────────────────────────
  # Gate Evaluation
  # ─────────────────────────────────────────────────────────────

  gate_evaluation:
    enabled: true
    use_judge: true
    judge_agent: "$CLAUDE_PLUGIN_ROOT/agents/gate-judge.md"
    judge_model: "sonnet"
    rubric_directory: "specs/templates/gate-rubrics/"
    gates:
      - id: "gate_1_problem"
        phase: "2.5"
        rubric: "problem-quality-rubric.md"
        thresholds:
          green: 3.5
          yellow: 2.5
      - id: "gate_2_true_need"
        phase: "2.7"
        rubric: "true-need-rubric.md"
        thresholds:
          green: 3.5
          yellow: 2.5

# =============================================================================
# CLI DISPATCH CONFIGURATION (v1.0)
# =============================================================================
# Replaces PAL MCP ThinkDeep and Consensus with direct CLI dispatch.
# Uses dispatch-cli-agent.sh (scripts/dispatch-cli-agent.sh) to invoke
# Codex, Gemini, and OpenCode CLIs for tri-model analysis.
#
# CLI → Model mapping:
#   codex    → GPT-4o (OpenAI)    — precision, logical rigor, structured analysis
#   gemini   → Gemini Pro (Google) — breadth, cross-domain synthesis
#   opencode → Grok (xAI via OpenRouter) — contrarian, assumption-challenging

cli_dispatch:
  # Master switch — set to false to use internal reasoning only
  enabled: true
  version: "1.0.0"

  # Script path (relative to plugin root)
  script_path: "scripts/dispatch-cli-agent.sh"

  # CLI client config directory (relative to plugin root)
  cli_clients_dir: "config/cli_clients"

  # ─────────────────────────────────────────────────────────────
  # TIMEOUT CONFIGURATION (per-integration)
  # ─────────────────────────────────────────────────────────────

  timeouts:
    challenge_seconds: 120       # Integration 1: Challenge (Stage 2)
    edge_cases_seconds: 150      # Integration 2: Edge Cases (Stage 4)
    triangulation_seconds: 90    # Integration 3: Triangulation (Stage 4)
    evaluation_seconds: 120      # Integration 4: Evaluation (Stage 5)
    default_seconds: 300         # Default fallback timeout

  # ─────────────────────────────────────────────────────────────
  # RETRY CONFIGURATION
  # ─────────────────────────────────────────────────────────────

  retry:
    max_attempts: 2              # Max retries per CLI call on failure
    retry_on_exit_codes: [1, 2]  # Retry on CLI failure (1) or timeout (2)
    no_retry_on: [3]             # Don't retry if CLI not found (exit 3)

  # ─────────────────────────────────────────────────────────────
  # CIRCUIT BREAKER
  # ─────────────────────────────────────────────────────────────

  circuit_breaker:
    enabled: true
    # If ALL 3 CLIs fail for an integration, skip it (don't block workflow)
    skip_on_all_fail: true
    # Minimum substantive responses needed for evaluation (Integration 4)
    min_responses_for_evaluation: 2

  # ─────────────────────────────────────────────────────────────
  # INTEGRATION DEFINITIONS
  # ─────────────────────────────────────────────────────────────

  integrations:
    challenge:
      enabled: true
      stage: 2
      condition: "CLI_AVAILABLE"
      output_dir: "analysis/"
      output_file: "mpa-challenge-parallel.md"
      models:
        - cli: "codex"
          role: "spec_root_cause"
        - cli: "gemini"
          role: "spec_alt_framing"
        - cli: "opencode"
          role: "spec_assumption_probe"

    edge_cases:
      enabled: true
      stage: 4
      condition: "CLI_AVAILABLE"
      output_dir: "analysis/"
      output_file: "mpa-edgecases-parallel.md"
      models:
        - cli: "codex"
          role: "edge_technical_quality"
        - cli: "gemini"
          role: "edge_ux_coverage"
        - cli: "opencode"
          role: "edge_ops_compliance"

    triangulation:
      enabled: true
      stage: 4
      condition: "CLI_AVAILABLE"
      output_dir: "analysis/"
      output_file: "mpa-triangulation.md"
      models:
        - cli: "codex"
          role: "spec_q_technical"
        - cli: "gemini"
          role: "spec_q_coverage"
        - cli: "opencode"
          role: "spec_q_contrarian"

    evaluation:
      enabled: true
      stage: 5
      condition: "CLI_AVAILABLE"
      output_dir: "analysis/"
      output_file: "mpa-evaluation.md"
      models:
        - cli: "gemini"
          role: "spec_evaluator_neutral"
        - cli: "codex"
          role: "spec_evaluator_for"
        - cli: "opencode"
          role: "spec_evaluator_against"

  # ─────────────────────────────────────────────────────────────
  # OUTPUT CONFIGURATION
  # ─────────────────────────────────────────────────────────────

  output:
    # Intermediate prompt files (per CLI dispatch call)
    prompt_dir: "analysis/cli-prompts/"
    # Output files per dispatch call (before synthesis)
    raw_output_dir: "analysis/cli-outputs/"
    # Metrics sidecars written by dispatch script
    metrics_dir: "analysis/cli-metrics/"

# =============================================================================
# REMOVED: thinkdeep (PAL MCP ThinkDeep v4.1) — superseded by cli_dispatch
# REMOVED: pal_consensus (PAL MCP Consensus v2.0) — superseded by cli_dispatch
# Active configuration: see cli_dispatch section above.
# =============================================================================

# =============================================================================
# DESIGN BRIEF CONFIGURATION (v2.0)
# =============================================================================
# MANDATORY: Design brief generation is NEVER skipped.
# This ensures every feature has proper design documentation.

design_artifacts:
  # MANDATORY generation - BOTH files always required
  skip_allowed: false  # NEVER skip design artifact generation
  skip_for_efficiency: false  # NEVER skip even for "efficiency"

  # Both files are ALWAYS required
  required_outputs:
    - "design-brief.md"    # Screen and state inventory (MANDATORY)
    - "design-supplement.md" # Design analysis and recommendations (MANDATORY)

  # Generation triggers - BOTH agents run regardless of Figma
  generation:
    # When Figma is NOT available
    no_figma:
      agents:
        - agent: "design-brief-generator"
          mandatory: true
          output: "design-brief.md"
        - agent: "gap-analyzer"
          mandatory: true
          output: "design-supplement.md"
          mode: "spec-only"  # Analyze spec without Figma context

    # When Figma IS available
    with_figma:
      agents:
        - agent: "design-brief-generator"
          mandatory: true
          output: "design-brief.md"
        - agent: "gap-analyzer"
          mandatory: true
          output: "design-supplement.md"
          mode: "with-figma"  # Analyze spec WITH Figma context

  # Quality requirements
  quality:
    min_screens_documented: 1
    require_state_matrix: true
    require_user_journeys: true
    require_edge_cases: true

# =============================================================================
# SPEC QUALITY: TECHNICAL LANGUAGE PROHIBITION
# =============================================================================
# Specifications must be technology-agnostic. These keywords are FORBIDDEN
# in spec output. The BA agent scans for them during draft and update phases.

spec_quality:
  technical_keywords_forbidden:
    # Framework / library names (multi-platform)
    frameworks:
      # Android
      - "Room"
      - "DataStore"
      - "Hilt"
      - "Compose"
      - "ViewModel"
      - "LiveData"
      # iOS / macOS
      - "SwiftUI"
      - "UIKit"
      - "AppKit"
      - "CoreData"
      - "Combine"
      - "Alamofire"
      # Web Frontend
      - "React"
      - "Redux"
      - "Next.js"
      - "Angular"
      - "Vue"
      - "Svelte"
      - "Nuxt"
      - "Remix"
      # Web / API Backend
      - "Express"
      - "Fastify"
      - "Django"
      - "Flask"
      - "FastAPI"
      - "Rails"
      - "Spring Boot"
      - "Nest.js"
      # Desktop
      - "Electron"
      - "Tauri"
      - "WPF"
      - "Windows Forms"
      - ".NET MAUI"
      # Cloud / BaaS
      - "Firebase"
      - "Supabase"
      # Protocols
      - "GraphQL"
      - "gRPC"

    # Implementation / code patterns
    patterns:
      - "data class"
      - "interface {"
      - "/api/v"
      - "SELECT * FROM"
      - "REST endpoint"
      - "WebSocket"
      - "async/await"
      - "Coroutine"
      - "Flow"
      - "RxJava"
      - "useState"
      - "useEffect"
      - "struct {"
      - "goroutine"
      - "Task.Run"

    # Architecture terminology
    architecture:
      - "MVVM"
      - "MVI"
      - "Clean Architecture"
      - "Repository pattern"
      - "microservices"
      - "CQRS"
      - "event-driven"
      - "monolith"
      - "hexagonal"
      - "DDD"

# =============================================================================
# TEST STRATEGY CONFIGURATION (v1.0)
# =============================================================================
# V-Model test strategy generation for comprehensive test planning.
# Generates test plans that map Acceptance Criteria to test levels.
#
# V-Model Layers:
# - Unit Tests (Inner Loop - TDD, automated in CI)
# - Integration Tests (Inner Loop - automated in CI)
# - E2E Tests (Outer Loop - agentic/manual with screenshots)
# - Visual Tests (Outer Loop - design compliance with Figma oracles)

test_strategy:
  # Master switch for test strategy generation
  enabled: true

  # Stage and checkpoint
  stage: 6
  checkpoint: "TEST_STRATEGY"

  # Agent configuration
  agent:
    name: "qa-strategist"
    path: "$CLAUDE_PLUGIN_ROOT/agents/qa-strategist.md"
    model: "sonnet"
    sequential_thinking:
      enabled: true
      thoughts: 4  # Risk, testability, journeys, synthesis

  # Output configuration
  output:
    file: "test-plan.md"
    template: "$CLAUDE_PLUGIN_ROOT/templates/test-plan-template.md"

  # Risk analysis categories — DOCUMENTATION ONLY.
  # This list is NOT read programmatically. The operative definitions live in:
  #   agents/qa-strategist.md (risk table) and agents/qa-references/sequential-thinking-templates.md (T1 template).
  # Changes here MUST be manually synchronized to those two files.
  risk_categories:
    # ── Core categories (all features) ─────────────────────────────────────────
    - "network_failure"          # UI, API, Backend, Mobile — connectivity loss, timeout handling
    - "permission_denial"        # UI, API, Backend, Mobile — auth failures, access control
    - "empty_states"             # UI, Mobile — absent data, null values, empty collections
    - "state_transitions"        # UI, Mobile, long-running processes — interruption, resumption
    - "concurrency"              # API, Backend, data pipelines — race conditions, simultaneous ops
    - "data_edge_cases"          # All features with user input — boundaries, encoding, special chars
    # ── Extended categories (production-mature / high-volume features) (v1.3.0) ─
    - "scalability_degradation"      # API, Backend, high-volume UI — 10x load, p95/p99, rate limits
    - "external_dependency_failure"  # API, Backend — third-party API/service downtime, degraded mode
    - "deployment_rollback"          # Backend, API, data pipelines — CI/CD safety, schema reversibility
    - "compliance_privacy"           # Any feature handling PII or regulated data — GDPR/CCPA

  # Optional inputs that enhance analysis
  optional_inputs:
    mpa_edgecases: true   # Pull edge cases from Stage 4 MPA reports
    design_supplement: true  # Use design-supplement.md for visual test targets

  # Skip conditions
  skip_conditions:
    allow_skip: false
    skip_reasons_allowed:
      - "documentation_only_feature"
      - "user_explicit_skip"

# =============================================================================
# SKILL ORCHESTRATOR CONFIGURATION (v1.0)
# =============================================================================
# Configuration for the specify skill orchestrator.
# Controls coordinator dispatch, iteration, and context management.

skill_orchestrator:
  version: "1.0.0"

  # ─────────────────────────────────────────────────────────────
  # STAGE DISPATCH PROFILES
  # ─────────────────────────────────────────────────────────────
  # Defines which shared references and config sections each stage loads.
  # Reduces coordinator context by loading ONLY what's needed.

  stage_dispatch_profiles:
    stage_2_spec_draft:
      shared_refs:
        - "checkpoint-protocol"
        - "error-handling"
      config_yaml: true
      extra_refs:
        - name: "cli-dispatch-patterns"
          condition: "CLI_AVAILABLE"
    stage_3_checklist:
      shared_refs:
        - "checkpoint-protocol"
        - "error-handling"
      config_yaml: true
      extra_refs: []
    stage_4_clarification:
      shared_refs:
        - "checkpoint-protocol"
        - "error-handling"
      config_yaml: true
      extra_refs:
        - name: "cli-dispatch-patterns"
          condition: "CLI_AVAILABLE"
    stage_5_validation_design:
      shared_refs:
        - "checkpoint-protocol"
        - "error-handling"
      config_yaml: true
      extra_refs:
        - name: "config-reference"
          condition: "always"
    stage_6_test_strategy:
      shared_refs:
        - "checkpoint-protocol"
        - "error-handling"
      config_yaml: true
      extra_refs: []
    stage_7_completion:
      shared_refs:
        - "checkpoint-protocol"
      config_yaml: false
      extra_refs: []

  # ─────────────────────────────────────────────────────────────
  # ITERATION CONTROL
  # ─────────────────────────────────────────────────────────────
  # Controls the Stage 3 <-> Stage 4 iteration loop.

  iteration:
    coverage_target: 85  # Percentage — loop until this coverage reached
    stall_threshold: 5   # Percentage — if improvement < this, ask user
    max_iterations: 10   # Safety circuit breaker

  # ─────────────────────────────────────────────────────────────
  # COORDINATOR CONTEXT LIMITS
  # ─────────────────────────────────────────────────────────────

  coordinator_prompt_max: 8000  # Max tokens for coordinator prompt (approximate)
  max_summary_length: 500       # Max chars for YAML summary field
  max_context_for_next_stage: 1000  # Max chars for Context body in summary file

