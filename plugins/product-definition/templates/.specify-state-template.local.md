---
# Specify Workflow State v2
# This file tracks the progress of /sdd:01-specify workflow
# It enables resume after interruption and preserves user decisions
# It also enables re-running clarification/validation on completed workflows
schema_version: 2
feature_id: "{NUMBER}-{SHORT_NAME}"
feature_name: "{FEATURE_NAME}"
user_input: "{ORIGINAL_USER_INPUT}"
created: "{ISO_DATE}"
updated: "{ISO_DATE}"

# Workflow Locking (G3 - prevents concurrent edits)
lock_info:
  locked: false
  locked_at: null
  locked_by: null  # session identifier
  stale_threshold_hours: 2

# Workflow Progress
# Phases: INIT | FIGMA_CAPTURE | RESEARCH_DISCOVERY | RESEARCH_ANALYSIS | SPEC_DRAFT | CHECKLIST_CREATION | CHECKLIST_VALIDATION | CLARIFICATION | PAL_GATE | DESIGN_FEEDBACK | COMPLETE
current_phase: "INIT"
phase_status: "pending"  # pending | in_progress | completed | failed

# Phase Completion Tracking
phases:
  init:
    status: pending
    timestamp: null
  figma_capture:
    status: pending
    timestamp: null
    figma_available: null  # true | false
    screens_captured: 0
    screens_directory: null
  research_discovery:
    status: pending
    timestamp: null
    mode: null  # simple | mpa
    user_decision: null  # conduct_research | skip_with_context | skip_entirely
    questions_generated: 0
    questions_by_perspective:
      strategic: 0
      technical: 0
      ux: 0
    questions_after_synthesis: 0
    critical_count: 0
    high_count: 0
    output_file: null  # research/RESEARCH-AGENDA.md
  research_analysis:
    status: pending
    timestamp: null
    reports_detected: 0
    reports_analyzed: []
    # Structure for each report:
    # - filename: "research-competitors.md"
    #   word_count: 1500
    #   insights_extracted: 8
    synthesis_complete: false
    consensus_findings: 0
    contradictions: 0
    research_gaps: 0
    output_file: null  # research-synthesis.md
  spec_draft:
    status: pending
    timestamp: null
    iterations: 0
  checklist_creation:
    status: pending
    timestamp: null
    template_used: null
    platform_type: null
  checklist_validation:
    status: pending
    timestamp: null
    iteration: 0
    max_iterations: 3
    last_score: null
    last_total: null
    last_coverage_pct: null
    gaps_identified: []
  clarification:
    status: pending
    timestamp: null
    iteration: 0
    current_batch: 0
    total_batches: 0
    questions_answered: 0
    questions_remaining: 0
    markers_found: 0
    markers_resolved: 0
    pending_questions: []
  pal_gate:
    status: pending
    timestamp: null
    iteration: 0
    max_iterations: 2
    pal_score: null
    pal_total: null
    pal_agreement_pct: null
    pal_decision: null  # APPROVED | CONDITIONAL | REJECTED
    dissenting_views: []
  design_feedback:
    status: pending
    timestamp: null
    figma_available: null
    agent_used: null  # gap-analyzer | design-brief-generator
    outputs: []

  # MPA Framework (ThinkDeep Integration v4)
  mpa_challenge:  # Phase 2.3
    status: pending
    timestamp: null
    parallel_mode: null  # true | false
    models_executed: []
    # Structure for each model:
    # - alias: "gpt5.2"
    #   thinking_mode: "high"
    #   focus: "root_cause_analysis"
    #   duration_ms: 42000
    #   status: "success"
    #   findings_count: 3
    synthesis:
      model: null
      strategy: null
      duration_ms: null
      total_findings_before_dedup: null
      deduplicated_count: null
      final_findings_count: null
    findings:
      assumptions_challenged: 0
      risk_level: null  # green | yellow | red
      cross_model_findings: 0
      priority_distribution:
        critical: 0
        high: 0
        medium: 0
    auto_incorporated: 0
    user_reviewed: 0
    action_taken: null
    red_flag_triggered: false

  mpa_edgecases:  # Phase 4.3
    status: pending
    timestamp: null
    parallel_mode: null
    models_executed: []
    synthesis:
      model: null
      strategy: null
      severity_boost_applied: null
      deduplicated_count: null
      final_findings_count: null
    findings:
      critical: 0
      high: 0
      medium: 0
      low: 0
      by_category:
        error_handling: 0
        concurrency: 0
        security: 0
        performance: 0
        accessibility: 0
        i18n: 0
    injected_clarifications: 0
    injected_questions: []

  mpa_triangulation:  # Phase 4.6
    status: pending
    timestamp: null
    models:
      pro:
        questions_generated: 0
        duration_ms: null
      gpt5_2:
        questions_generated: 0
        duration_ms: null
    original_questions: 0
    deduplicated: 0
    final_questions: 0
    cross_model_agreement: []
    # Structure for each agreement:
    # - question: "Network failure during save?"
    #   gemini: true
    #   gpt: true
    #   priority: "HIGH"

# User Decisions (preserved across interruptions - NEVER re-ask these)
user_decisions:
  platform_choice: null  # mobile | generic
  research_mode: null  # simple | mpa | null (user chose skip_entirely)
  research_decision: null  # conduct_research | skip_with_context | skip_entirely
  research_context: null  # User-provided context if skip_with_context chosen
  clarifications: []
  # Structure for each clarification:
  # - question: "What authentication method should be used?"
  #   answer: "OAuth2 with Google Sign-In"
  #   response_type: "selected"  # selected | custom
  #   ba_recommended: "OAuth2 with Google Sign-In (Recommended)"
  #   user_chose_recommended: true
  #   batch: 1
  #   timestamp: "2025-01-17T10:30:00Z"
  #   phase: "CLARIFICATION"
  #   iteration: 1

# Error Tracking (G5 - AskUserQuestion error handling)
error_log: []
  # Structure for each error:
  # - timestamp: "2025-01-17T10:35:00Z"
  #   error_type: "NO_RESPONSE"  # NO_RESPONSE | TIMEOUT | INVALID_FORMAT
  #   phase: "CLARIFICATION"
  #   question_batch: 1
  #   retry_attempt: 1
  #   recovery_action: "RETRY"  # RETRY | SKIP | BULK_MODE

# Checkpoint Log (tracks phase completions for audit)
checkpoint_log: []
  # Structure for each checkpoint:
  # - phase: "SPEC_DRAFT"
  #   status: "completed"
  #   timestamp: "2025-01-17T10:40:00Z"
  #   key_outputs:
  #     - "spec.md written with all sections"
  #     - "Self-critique score: 17/20"
  #   artifacts:
  #     - path: "spec.md"
  #       hash: null  # optional content hash for integrity

# Resume Guidance
next_step: "Begin specification workflow"
can_resume: true
---

## Workflow Log

<!-- This section is appended automatically as the workflow progresses -->
<!-- Each entry includes timestamp, phase, action, and outcome -->
<!-- Format: ### {ISO_DATE} - Phase: {PHASE_NAME} -->

### Workflow Initialized
- **Timestamp**: {ISO_DATE}
- **Feature**: {FEATURE_NAME}
- **Schema Version**: v2
- **Status**: Ready to begin

