---
# Requirements Refinement State File
# Version: 1.0.0
# DO NOT manually edit YAML frontmatter - managed by workflow

# Metadata
schema_version: 1
created: "{ISO_TIMESTAMP}"
updated: "{ISO_TIMESTAMP}"

# Workflow Identity
prd_mode: "NEW"  # NEW | EXTEND
draft_file: "{DRAFT_FILENAME}"

# Workflow Progress
current_phase: "INIT"
phase_status: "pending"  # pending | in_progress | completed | failed | waiting_for_user
question_round: 0

# Analysis Mode (user choice - IMMUTABLE once set per round)
analysis_mode: null  # complete | advanced | standard | rapid

# Phase Tracking
phases:
  preflight:
    status: pending
    timestamp: null
  init:
    status: pending
    prd_existed: false
    draft_copied: false
    timestamp: null
  analysis_mode_selection:
    status: pending
    mode: null
    timestamp: null
  research_discovery:
    status: pending  # pending | skipped | completed | waiting_for_user
    mode: null  # simple | mpa | null
    round: 0
    questions_generated: 0
    timestamp: null
  research_analysis:
    status: pending
    reports_detected: 0
    reports_analyzed: 0
    synthesis_complete: false
    timestamp: null
  deep_analysis:
    status: pending  # pending | skipped | completed
    mode: null  # complete | advanced (only runs for these modes)
    thinkdeep_calls: 0  # Max 9 (3 perspectives Ã— 3 models)
    insights_generated: false
    convergent_findings: 0
    divergent_findings: 0
    timestamp: null
  question_generation:
    status: pending
    round: 0
    mode: null
    questions_generated: 0
    timestamp: null
  user_response:
    status: pending  # pending | waiting_for_user | completed
    round: 0
    questions_answered: 0
    questions_total: 0
    completion_rate: 0
    timestamp: null
  response_analysis:
    status: pending
    mode: null
    gaps_found: 0
    rounds_completed: 0
    timestamp: null
  validation:
    status: pending
    mode: null  # pal_consensus | single | skipped
    score: null
    decision: null  # READY | CONDITIONAL | NOT_READY
    timestamp: null
  prd_generation:
    status: pending
    prd_mode: null  # new | extend
    sections_generated: 0
    sections_extended: 0
    timestamp: null
  completion:
    status: pending
    timestamp: null

# User Decisions (IMMUTABLE once recorded)
user_decisions:
  analysis_mode_round_1: null
  analysis_mode_round_2: null
  analysis_mode_round_3: null
  research_decisions:
    pre_round_1: null  # conduct_research | skip_with_context | skip_entirely
    pre_round_2: null
    pre_round_3: null
    post_completion: null
  research_context: null  # User-provided context if skip_with_context
  extend_mode_choice: null  # expand | regenerate | specific
  validation_mode: null  # pal_consensus | single | skip

# Round Tracking
rounds: []
  # Format for each round:
  # - round_number: 1
  #   questions_file: "working/QUESTIONS-001.md"
  #   analysis_mode: "complete"
  #   generated_at: "{ISO}"
  #   answered_at: null
  #   questions_count: 18
  #   gaps_identified: []

# PRD Section Status (for EXTEND mode)
prd_sections:
  executive_summary: null  # COMPLETE | PARTIAL | PLACEHOLDER | MISSING
  product_definition: null
  target_users: null
  problem_analysis: null
  value_proposition: null
  core_workflows: null
  feature_inventory: null
  screen_inventory: null
  business_constraints: null
  assumptions_risks: null

# Error Log
error_log: []
  # Format:
  # - timestamp: "{ISO}"
  #   phase: "phase_name"
  #   error: "error message"
  #   recovery: "action taken"

# Checkpoint Log
checkpoint_log: []
  # Format:
  # - phase: "init"
  #   status: "completed"
  #   timestamp: "{ISO}"
  #   artifacts: ["working/draft-copy.md"]
  #   git_commit_suggested: "wip(req): initialize requirements"

# Resume Guidance
next_step: null
can_resume: true
waiting_for_user: false
---

## Workflow Log

<!-- Append-only log of workflow actions -->

### {TIMESTAMP} - Workflow Initialized
- **PRD Mode:** {NEW|EXTEND}
- **Draft File:** {FILENAME}
- **State File Created**
